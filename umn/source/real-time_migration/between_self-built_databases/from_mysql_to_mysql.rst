:original_name: drs_03_1117.html

.. _drs_03_1117:

From MySQL to MySQL
===================

Supported Source and Destination Databases
------------------------------------------

.. table:: **Table 1** Supported databases

   +-----------------------------------------------------------------------+-----------------------------------------------------------------------+
   | Source DB                                                             | Destination DB                                                        |
   +=======================================================================+=======================================================================+
   | -  Self-built MySQL database on ECS (versions 5.5, 5.6, 5.7, and 8.0) | -  Self-built MySQL database on ECS (versions 5.5, 5.6, 5.7, and 8.0) |
   | -  On-premises MySQL database (versions 5.5, 5.6, 5.7, and 8.0)       | -  On-premises MySQL database (versions 5.5, 5.6, 5.7, and 8.0)       |
   +-----------------------------------------------------------------------+-----------------------------------------------------------------------+

.. _drs_03_1117__section1891412810322:

Suggestions
-----------

.. caution::

   -  When a task is being started or in the full migration phase, do not perform DDL operations on the source database. Otherwise, the task may be abnormal.
   -  To maintain data consistency before and after the migration, do not write data to the source and destination databases in the full migration mode. In the full+incremental migration mode, you can continue the migration while data is still being written to the source database.

-  The success of migration depends on environment and manual operations. You can run a migration test before you start the full-scale migration to help you detect and resolve problems in advance.

-  Start your migration task during off-peak hours. A less active database is easier to migrate successfully. If the data is fairly static, there is less likely to be any severe performance impacts during the migration. If you have to migrate data during peak hours, you can select **Yes** for **Flow Control** to adjust the migration speed.

   -  If network bandwidth is not limited, the query rate of the source database increases by about 50 MB/s during full migration, and two to four CPUs are occupied.

   -  To ensure data consistency, tables to be migrated without a primary key may be locked for 3s.
   -  The data being migrated may be locked by other transactions for a long period of time, resulting in read timeout.
   -  Due to the inherent characteristics of MySQL, in some scenarios the performance may be negatively affected. For example, if the CPU resources are insufficient and the storage engine is TokuDB, the read speed on tables may be decreased by 10%.
   -  If DRS concurrently reads data from a database, it will use about 6 to 10 sessions. The impact of the connections on services must be considered.
   -  If you read a table, especially a large table, during the full migration, the exclusive lock on that table may be blocked.

-  Data-level comparison

   To obtain accurate comparison results, compare data at a specified time point during off-peak hours. If it is needed, select **Start at a specified time** for **Comparison Time**. Due to slight time difference and continuous operations on data, inconsistent comparison results may be generated, reducing the reliability and validity of the results.

.. _drs_03_1117__section182303625619:

Precautions
-----------

Before creating a migration task, read the following notes:

.. table:: **Table 2** Precautions

   +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Type                              | Restrictions                                                                                                                                                                                                                                                                                                                          |
   +===================================+=======================================================================================================================================================================================================================================================================================================================================+
   | Database permissions              | -  Full migration:                                                                                                                                                                                                                                                                                                                    |
   |                                   |                                                                                                                                                                                                                                                                                                                                       |
   |                                   |    -  The source database user must have the SELECT, SHOW VIEW, and EVENT permissions.                                                                                                                                                                                                                                                |
   |                                   |    -  The destination database user must have the following permissions: SELECT, CREATE, ALTER, DROP, DELETE, INSERT, UPDATE, INDEX, EVENT, CREATE VIEW, CREATE ROUTINE, TRIGGER, REFERENCES, and WITH GRANT OPTION.                                                                                                                  |
   |                                   |                                                                                                                                                                                                                                                                                                                                       |
   |                                   | -  Full+incremental migration:                                                                                                                                                                                                                                                                                                        |
   |                                   |                                                                                                                                                                                                                                                                                                                                       |
   |                                   |    -  The source database user must have the following permissions: SELECT, SHOW VIEW, EVENT, LOCK TABLES, REPLICATION SLAVE, and REPLICATION CLIENT.                                                                                                                                                                                 |
   |                                   |    -  The destination database user must have the following permissions: SELECT, CREATE, ALTER, DROP, DELETE, INSERT, UPDATE, INDEX, EVENT, CREATE VIEW, CREATE ROUTINE, TRIGGER, REFERENCES, and WITH GRANT OPTION.                                                                                                                  |
   |                                   |                                                                                                                                                                                                                                                                                                                                       |
   |                                   | -  Account migration:                                                                                                                                                                                                                                                                                                                 |
   |                                   |                                                                                                                                                                                                                                                                                                                                       |
   |                                   |    -  The user must have the SELECT permission for mysql.user.                                                                                                                                                                                                                                                                        |
   |                                   |    -  The destination database user must have the SELECT, INSERT, UPDATE, and DELETE permissions for the MySQL database.                                                                                                                                                                                                              |
   +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Migration objects                 | -  Supported objects: databases, tables, views, indexes, constraints, functions, stored procedures, triggers, and events.                                                                                                                                                                                                             |
   |                                   | -  The system database and event statuses cannot be migrated.                                                                                                                                                                                                                                                                         |
   |                                   | -  Tables with storage engine different to MyISAM and InnoDB tables cannot be migrated.                                                                                                                                                                                                                                               |
   +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Source database                   | -  The source database names cannot contain non-ASCII characters, or the following characters: '<`>/\\"                                                                                                                                                                                                                               |
   |                                   | -  The source table and view names cannot contain non-ASCII characters, or the following characters: '<>/\\"                                                                                                                                                                                                                          |
   |                                   | -  The source database name cannot start with **ib_logfile** and cannot be **ib_buffer_pool**, **ib_doublewrite**, **ibdata1 or ibtmp1**.                                                                                                                                                                                             |
   |                                   | -  The binlog of the MySQL source database must be enabled and use the row-based format during incremental migration.                                                                                                                                                                                                                 |
   |                                   | -  If the storage space is sufficient, store the source database binlog for as long as possible. The recommended retention period is three days.                                                                                                                                                                                      |
   |                                   | -  If the **expire_logs_days** value of the source database is **0**, the migration may fail.                                                                                                                                                                                                                                         |
   |                                   | -  During an incremental migration, the **server_id** value of the MySQL source database must be set. If the source database version is MySQL 5.6 or earlier, the **server_id** value ranges from **2** to **4294967296**. If the source database is MySQL 5.7 or later, the **server_id** value ranges from **1** to **4294967296**. |
   |                                   | -  Enable **skip-name-resolve** for the MySQL source database to reduce the possibility of connection timeout.                                                                                                                                                                                                                        |
   |                                   | -  Enable GTID for the source database. If GTID is not enabled for the source database, primary/standby switchover is not supported. DRS tasks will be interrupted and cannot be restored during a switchover.                                                                                                                        |
   |                                   | -  The source database does not support the **mysql binlog dump** command.                                                                                                                                                                                                                                                            |
   |                                   | -  The character sets of the source and destination databases must be the same. Otherwise, the migration fails.                                                                                                                                                                                                                       |
   |                                   | -  The **log_slave_updates** parameter of the source database must be enabled. Otherwise, the migration fails.                                                                                                                                                                                                                        |
   |                                   | -  The **binlog_row_image** parameter value of the source database must be **FULL**. Otherwise, the migration fails.                                                                                                                                                                                                                  |
   +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Destination database              | -  Data cannot be migrated from a newer version database to an older version database.                                                                                                                                                                                                                                                |
   |                                   | -  You are advised to use the row-based binlog in the destination MySQL database. Otherwise, an error may occur during an incremental migration.                                                                                                                                                                                      |
   |                                   | -  The destination DB instance is running properly.                                                                                                                                                                                                                                                                                   |
   |                                   | -  The destination DB instance must have sufficient storage space.                                                                                                                                                                                                                                                                    |
   |                                   | -  The destination DB instance cannot contain databases with the same name as the source databases (except the MySQL system database).                                                                                                                                                                                                |
   |                                   | -  The destination database isolation level must be set to at least read committed.                                                                                                                                                                                                                                                   |
   |                                   | -  During migration, a large amount of data is written to the destination database. If the value of the **max_allowed_packet** parameter of the destination database is too small, data cannot be written. You are advised to set the **max_allowed_packet** parameter to a value greater than 100 MB.                                |
   |                                   | -  Enable GTID of the destination database.                                                                                                                                                                                                                                                                                           |
   |                                   | -  If the **server_uuid** values of the source and destination databases are the same, the incremental migration fails.                                                                                                                                                                                                               |
   |                                   | -  The **collation_server** values of the source and destination databases must be the same. Otherwise, the migration fails.                                                                                                                                                                                                          |
   |                                   | -  The table containing the foreign key must be migrated with the referenced tables. Otherwise, the migration fails.                                                                                                                                                                                                                  |
   |                                   | -  The **time_zone** values of the source and destination databases must be the same. Otherwise, the migration fails.                                                                                                                                                                                                                 |
   |                                   | -  The **sql_mode** values of the source and destination databases must be the same. Otherwise, the migration fails.                                                                                                                                                                                                                  |
   |                                   | -  If the MyISAM tables are included in the migration objects, the **sql_mode** parameter in the destination database cannot contain the **no_engine_substitution** parameter. Otherwise, the migration fails.                                                                                                                        |
   |                                   | -  The **innodb_strict_mode** values of the source and destination databases must be the same. Otherwise, the migration fails.                                                                                                                                                                                                        |
   |                                   | -  The **lower_case_table_names** values of the source and destination databases must be the same. Otherwise, the migration fails.                                                                                                                                                                                                    |
   |                                   | -  The **log_bin_trust_function_creators** parameter value of the destination database must be set to **on**. Otherwise, the migration fails.                                                                                                                                                                                         |
   +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Precautions                       | -  Associated objects must be migrated at the same time to avoid migration failure caused by missing associated objects. Common dependencies: tables referenced by views, views referenced by views, views and tables referenced by stored procedures/functions/triggers, and tables referenced by primary and foreign keys           |
   |                                   | -  Due to the MySQL constraints, if the one-time event triggering time of the source database is earlier than the migration start time, the event will not be migrated to the destination database.                                                                                                                                   |
   |                                   | -  When creating multiple migration tasks in the many-to-one scenario, ensure that the read and write settings of the destination database are consistent in these tasks.                                                                                                                                                             |
   |                                   | -  DDL operations such as, creating users, deleting users, and modifying user permissions, will not be migrated during incremental migration.                                                                                                                                                                                         |
   |                                   | -  The table without a primary key lacks a unique identifier for rows. When the network is unstable, you may need to retry the task several times, or data inconsistency may occur.                                                                                                                                                   |
   |                                   | -  Cascade operations cannot be performed on tables with foreign keys. If the foreign key index of a table is a common index, the table structure may fail to be created. You are advised to use a unique index.                                                                                                                      |
   |                                   | -  The destination database cannot be restored to a point in time when a full migration was being performed.                                                                                                                                                                                                                          |
   |                                   | -  During task startup or full migration, you are not advised to perform DDL operations on the source database, such as deleting the database, indexes, or views. Otherwise, the migration may fail.                                                                                                                                  |
   |                                   | -  The selected events and triggers are migrated while the migration task proceeds to the final stage. Before a task is completed, ensure that the source and destination databases are connected and pay attention to the migration status reported by the migration log.                                                            |
   |                                   | -  During migration, do not modify or delete the usernames, passwords, permissions, or ports of the source and destination databases.                                                                                                                                                                                                 |
   |                                   | -  During an incremental migration, do not perform the point-in-time recovery (PITR) operation on the source database.                                                                                                                                                                                                                |
   |                                   | -  To ensure data consistency, do not modify the destination database (including but not limited to DDL and DML operations) during migration.                                                                                                                                                                                         |
   |                                   | -  During an incremental migration, resumable upload is supported. However, data may be repeatedly inserted into a non-transactional table that does not have a primary key when the server system breaks down.                                                                                                                       |
   |                                   | -  During migration, do not write the statement-based binlog into the source database.                                                                                                                                                                                                                                                |
   |                                   | -  During migration, do not clear the binlog in the source database.                                                                                                                                                                                                                                                                  |
   |                                   | -  During an incremental migration of table-level objects, renaming tables is not supported.                                                                                                                                                                                                                                          |
   |                                   | -  If the source database is an on-premises database and has Percona Server for MySQL 5.6.x or Percona Server for MySQL 5.7.x installed, the memory manager must use Jemalloc to prevent Out of Memory errors caused by frequent queries on system tables.                                                                            |
   |                                   | -  The source database does not support the **mysql binlog dump** command.                                                                                                                                                                                                                                                            |
   |                                   | -  The source database does not support the **reset master** or **reset master to** command, which may cause DRS task failures or data inconsistency.                                                                                                                                                                                 |
   |                                   | -  During migration, do not create a database named **ib_logfile** in the source database.                                                                                                                                                                                                                                            |
   |                                   | -  Set **expire_log_day** to a proper value to ensure that the binlog does not expire before data transfer resumes. This ensures that services can be recovered after interruption.                                                                                                                                                   |
   +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Prerequisites
-------------

-  You have logged in to the DRS console.
-  For details about the DB types and versions supported by real-time migration, see :ref:`Real-Time Migration <drs_01_0301>`.

-  You have read :ref:`Suggestions <drs_03_1117__section1891412810322>` and :ref:`Precautions <drs_03_1117__section182303625619>`.

Procedure
---------

This section uses the migration from an RDS MySQL database to a MySQL database on an ECS as an example to describe how to configure a migration task in a VPC network on the DRS management console.

#. On the **Online Migration Management** page, click **Create Migration Task**.

#. On the **Create Replication Instance** page, configure task details, description, and the replication instance, and click **Next**.

   -  Task information description

      .. table:: **Table 3** Task information

         +-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Parameter   | Description                                                                                                                                                               |
         +=============+===========================================================================================================================================================================+
         | Region      | The region where the replication instance is deployed. You can change the region. To reduce latency and improve access speed, select the region closest to your services. |
         +-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Project     | The project corresponds to the current region and can be changed.                                                                                                         |
         +-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Task Name   | The task name must start with a letter and consist of 4 to 50 characters. It can contain only letters, digits, hyphens (-), and underscores (_).                          |
         +-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Description | The description consists of a maximum of 256 characters and cannot contain special characters ``!=<>'&"\``                                                                |
         +-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

   -  Replication instance information

      .. table:: **Table 4** Replication instance settings

         +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Parameter                         | Description                                                                                                                                                                                                                                                                                                            |
         +===================================+========================================================================================================================================================================================================================================================================================================================+
         | Data Flow                         | Choose **Self-built to self-built**.                                                                                                                                                                                                                                                                                   |
         +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Source DB Engine                  | Select **MySQL**.                                                                                                                                                                                                                                                                                                      |
         +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Destination DB Engine             | Select **MySQL**.                                                                                                                                                                                                                                                                                                      |
         +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Network Type                      | Select **Public network**.                                                                                                                                                                                                                                                                                             |
         |                                   |                                                                                                                                                                                                                                                                                                                        |
         |                                   | Available options: **VPN or Direct Connect**, and **Public network**. By default, the value is **Public network**.                                                                                                                                                                                                     |
         |                                   |                                                                                                                                                                                                                                                                                                                        |
         |                                   | -  Public network is suitable for migrations from on-premises or external cloud databases to the destination databases bound with an EIP.                                                                                                                                                                              |
         |                                   | -  VPN and Direct Connect are suitable for migrations from on-premises databases to cloud databases or between cloud databases across regions.                                                                                                                                                                         |
         +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | AZ                                | Select the AZ where you want to create the DRS instance. Selecting the one housing the source or destination database can provide better performance.                                                                                                                                                                  |
         +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | VPC                               | Select an available VPC.                                                                                                                                                                                                                                                                                               |
         +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Replication Instance Subnet       | The subnet where the replication instance resides. You can also click **View Subnet** to go to the network console to view the subnet where the instance resides.                                                                                                                                                      |
         |                                   |                                                                                                                                                                                                                                                                                                                        |
         |                                   | By default, the DRS instance and the destination DB instance are in the same subnet. You need to select the subnet where the DRS instance resides, and there are available IP addresses for the subnet. To ensure that the replication instance is successfully created, only subnets with DHCP enabled are displayed. |
         +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Security Group                    | Select a security group. You can use security group rules to allow or deny access to the instance.                                                                                                                                                                                                                     |
         +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Migration Type                    | -  **Full**: This migration type is suitable for scenarios where service interruption is acceptable. All objects and data in non-system databases are migrated to the destination database at one time. The objects include tables, views, and stored procedures.                                                      |
         |                                   |                                                                                                                                                                                                                                                                                                                        |
         |                                   |    .. note::                                                                                                                                                                                                                                                                                                           |
         |                                   |                                                                                                                                                                                                                                                                                                                        |
         |                                   |       If you are performing a full migration, do not perform operations on the source database. Otherwise, data generated in the source database during the migration will not be synchronized to the destination database.                                                                                            |
         |                                   |                                                                                                                                                                                                                                                                                                                        |
         |                                   | -  **Full+Incremental**: This migration type allows you to migrate data without interrupting services. After a full migration initializes the destination database, an incremental migration initiates and parses logs to ensure data consistency between the source and destination databases.                        |
         |                                   |                                                                                                                                                                                                                                                                                                                        |
         |                                   | .. note::                                                                                                                                                                                                                                                                                                              |
         |                                   |                                                                                                                                                                                                                                                                                                                        |
         |                                   |    If you select **Full+Incremental**, data generated during the full migration will be continuously synchronized to the destination database, and the source remains accessible.                                                                                                                                      |
         +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

   -  Tags

      .. table:: **Table 5** Tags

         +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------+
         | Parameter                         | Description                                                                                                                                    |
         +===================================+================================================================================================================================================+
         | Tags                              | -  Tags a task. This configuration is optional. Adding tags helps you better identify and manage your tasks. Each task can have up to 20 tags. |
         |                                   | -  After a task is created, you can view its tag details on the **Tags** tab. For details, see :ref:`Tag Management <drs_online_tag>`.         |
         +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------+

   .. note::

      If a task fails to be created, DRS retains the task for three days by default. After three days, the task automatically ends.

#. On the **Configure Source and Destination Databases** page, wait until the replication instance is created. Then, specify source and destination database information and click **Test Connection** for both the source and destination databases to check whether they have been connected to the replication instance. After the connection tests are successful, select the check box before the agreement and click **Next**.

   .. table:: **Table 6** Source database settings

      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                       |
      +===================================+===================================================================================================================================+
      | IP Address or Domain Name         | The IP address or domain name of the source database.                                                                             |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+
      | Port                              | The port of the source database. Range: 1 - 65535                                                                                 |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+
      | Database Username                 | The username for accessing the source database.                                                                                   |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+
      | Database Password                 | The password for the database username.                                                                                           |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+
      | SSL Connection                    | SSL encrypts the connections between the source and destination databases. If SSL is enabled, upload the SSL CA root certificate. |
      |                                   |                                                                                                                                   |
      |                                   | .. note::                                                                                                                         |
      |                                   |                                                                                                                                   |
      |                                   |    -  The maximum size of a single certificate file that can be uploaded is 500 KB.                                               |
      |                                   |    -  If the SSL certificate is not used, your data may be at risk.                                                               |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+

   .. note::

      The username and password of the source database are encrypted and stored in the database and the replication instance during the migration. After the task is deleted, the username and password are permanently deleted.

   .. table:: **Table 7** Destination database settings

      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                                                                                                                                                                               |
      +===================================+===========================================================================================================================================================================================================================================================================================================================================================+
      | IP Address or Domain Name         | The IP address or domain name of the source database.                                                                                                                                                                                                                                                                                                     |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Port                              | The port of the destination database. Range: 1 - 65535                                                                                                                                                                                                                                                                                                    |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Database Username                 | The username for accessing the destination database.                                                                                                                                                                                                                                                                                                      |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Database Password                 | The password for the database username.                                                                                                                                                                                                                                                                                                                   |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | SSL Connection                    | SSL encrypts the connections between the source and destination databases. If SSL is enabled, upload the SSL CA root certificate.                                                                                                                                                                                                                         |
      |                                   |                                                                                                                                                                                                                                                                                                                                                           |
      |                                   | .. note::                                                                                                                                                                                                                                                                                                                                                 |
      |                                   |                                                                                                                                                                                                                                                                                                                                                           |
      |                                   |    -  The maximum size of a single certificate file that can be uploaded is 500 KB.                                                                                                                                                                                                                                                                       |
      |                                   |    -  If the SSL certificate is not used, your data may be at risk.                                                                                                                                                                                                                                                                                       |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Migrate Definer to User           | -  Yes                                                                                                                                                                                                                                                                                                                                                    |
      |                                   |                                                                                                                                                                                                                                                                                                                                                           |
      |                                   |    The Definers of all source database objects will be migrated to the user. Other users do not have permissions for database objects unless these users are authorized. For details on authorization, see :ref:`How Do I Maintain the Original Service User Permission System After Definer Is Forcibly Converted During MySQL Migration? <drs_16_0003>` |
      |                                   |                                                                                                                                                                                                                                                                                                                                                           |
      |                                   | -  No                                                                                                                                                                                                                                                                                                                                                     |
      |                                   |                                                                                                                                                                                                                                                                                                                                                           |
      |                                   |    The Definers of all source database objects will not be changed. You need to migrate all accounts and permissions of the source database in the next step.                                                                                                                                                                                             |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

   .. note::

      The IP address, port, username, and password of the destination database are encrypted and stored in the database and the replication instance, and will be cleared after the task is deleted.

#. On the **Set Task** page, set migration accounts and objects, and click **Next**.

   .. table:: **Table 8** Migration types and objects

      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                                                                                                                                                                                    |
      +===================================+================================================================================================================================================================================================================================================================================================================================================================+
      | Flow Control                      | You can choose whether to control the flow.                                                                                                                                                                                                                                                                                                                    |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   | -  **Yes**                                                                                                                                                                                                                                                                                                                                                     |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   |    You can customize the maximum migration speed.                                                                                                                                                                                                                                                                                                              |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   |    In addition, you can set the time range based on your service requirements. The traffic rate setting usually includes setting of a rate limiting time period and a traffic rate value. Flow can be controlled all day or during specific time ranges. The default value is **All day**. A maximum of three time ranges can be set, and they cannot overlap. |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   |    The flow rate must be set based on the service scenario and cannot exceed 9,999 MB/s.                                                                                                                                                                                                                                                                       |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   | -  **No**                                                                                                                                                                                                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   |    The migration speed is not limited and the outbound bandwidth of the source database is maximally used, which will increase the read burden on the source database. For example, if the outbound bandwidth of the source database is 100 MB/s and 80% bandwidth is used, the I/O consumption on the source database is 80 MB/s.                             |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   |    .. note::                                                                                                                                                                                                                                                                                                                                                   |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   |       -  Flow control mode takes effect only during a full migration.                                                                                                                                                                                                                                                                                          |
      |                                   |       -  You can also change the flow control mode after creating a task. For details, see :ref:`Modifying the Flow Control Mode <drs_03_0046>`.                                                                                                                                                                                                               |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Filter DROP DATABASE              | During an incremental migration, executing DDL operations on the source database may affect the data migration performance to some extent. To reduce data migration risks, DRS allows you to filter out DDL operations.                                                                                                                                        |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   | The database deletion operation can be filtered out by default.                                                                                                                                                                                                                                                                                                |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   | -  If you select **Yes**, any database deletion operations performed on the source database are not synchronized during data migration.                                                                                                                                                                                                                        |
      |                                   | -  If you select **No**, related operations are synchronized to the destination database during data migration.                                                                                                                                                                                                                                                |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Migrating Accounts                | During a database migration, accounts need to be migrated separately.                                                                                                                                                                                                                                                                                          |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   | There are accounts that can be migrated completely, accounts whose permissions need to be reduced, and accounts that cannot be migrated. You can choose whether to migrate the accounts based on service requirements.                                                                                                                                         |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   | -  Yes                                                                                                                                                                                                                                                                                                                                                         |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   |    If you need to migrate accounts, see :ref:`Migrating Accounts <drs_09_0017>`.                                                                                                                                                                                                                                                                               |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   | -  No                                                                                                                                                                                                                                                                                                                                                          |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   |    During the migration, accounts, permissions, and passwords are not migrated.                                                                                                                                                                                                                                                                                |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Migration object                  | You can choose to migrate all objects, tables, or databases based on your service requirements.                                                                                                                                                                                                                                                                |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   | -  **All**: All objects in the source database are migrated to the destination database. After the migration, the object names will remain the same as those in the source database and cannot be modified.                                                                                                                                                    |
      |                                   | -  **Tables**: The selected table-level objects will be migrated.                                                                                                                                                                                                                                                                                              |
      |                                   | -  **Databases**: The selected database-level objects will be migrated.                                                                                                                                                                                                                                                                                        |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   | If the source database is changed, click |image1| in the upper right corner before selecting migration objects to ensure that the objects to be selected are from the changed source database.                                                                                                                                                                 |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   | .. note::                                                                                                                                                                                                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                |
      |                                   |    -  If you choose not to migrate all of the databases, the migration may fail because the objects, such as stored procedures and views, in the databases to be migrated may have dependencies on other objects that are not migrated. To prevent migration failure, migrate all of the databases.                                                            |
      |                                   |    -  If the object name contains spaces, the spaces before and after the object name are not displayed. If there are multiple spaces between the object name and the object name, only one space is displayed.                                                                                                                                                |
      |                                   |    -  The name of the selected migration object cannot contain spaces.                                                                                                                                                                                                                                                                                         |
      |                                   |    -  To quickly select the desired database objects, you can use the search function.                                                                                                                                                                                                                                                                         |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

#. On the displayed page, specify **Start Time** and confirm that the configured information is correct and click **Submit** to submit the task.

   .. table:: **Table 9** Task startup settings

      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                        |
      +===================================+====================================================================================================================================================================================================+
      | Started Time                      | Set **Start Time** to **Start upon task creation** or **Start at a specified time** based on site requirements. The **Start at a specified time** option is recommended.                           |
      |                                   |                                                                                                                                                                                                    |
      |                                   | .. note::                                                                                                                                                                                          |
      |                                   |                                                                                                                                                                                                    |
      |                                   |    The migration task may affect the performance of the source and destination databases. You are advised to start the task in off-peak hours and reserve two to three days for data verification. |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

#. On the **Check Task** page, check the migration task.

   -  If any check fails, review the cause and rectify the fault. After the fault is rectified, click **Check Again**.

      For details about how to handle check items that fail to pass the pre-check, see :ref:`Solutions to Failed Check Items <drs_11_0001>`.

   -  If the check is complete and the check success rate is 100%, click **Next**.

      .. note::

         You can proceed to the next step only when all checks are successful. If there are any items that require confirmation, view and confirm the details first before proceeding to the next step.

#. Compare source and destination parameters.

   By comparing common and performance parameters for the source databases against those of the destination databases, you can help ensure that services will not change after a migration is completed. You can determine whether to use this function based on service requirements. It mainly ensures that services are not affected after a migration is completed.

   -  This process is optional, so you can click **Next** to skip the comparison.

   -  Compare common parameters:

      If the common parameter values in the comparison results are inconsistent, click **Save Change** to change the destination database values to be the same as those of the source database.

      Performance parameter values in both the source and destination databases can be the same or different.

      -  If you need to change the performance parameter values that are consistent in the comparison results to different values, locate the target parameter, enter values in the **Change To** column, and click **Save Change** in the upper left corner.
      -  If you want to make the performance parameter values of the source and destination database be the same:

         a. Click **Use Source Database Value**.

            DRS automatically makes the destination database values the same as those of the source database.

            .. note::

               You can also manually enter parameter values.

         b. Click **Save Change** to save your changes.

            The system changes the parameter values based on your settings for the destination database values. After the modification, the list is updated automatically.

            Some parameters in the destination database require a restart before the changes can take effect. The system will display these as being inconsistent. In addition, restart the destination database before the migration task is started or after the migration task is completed. To minimize the impact of this restart on your services, it is recommended that you schedule a specific time to restart the destination database after the migration is complete.

            For details about how to set parameters during a comparison, see :ref:`Parameters for Comparison <drs_08_0001>`.

         c. Click **Next**.

#. On the displayed page, specify **Start Time** and confirm that the configured information is correct and click **Submit** to submit the task.

   .. table:: **Table 10** Task startup settings

      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                        |
      +===================================+====================================================================================================================================================================================================+
      | Started Time                      | Set **Start Time** to **Start upon task creation** or **Start at a specified time** based on site requirements. The **Start at a specified time** option is recommended.                           |
      |                                   |                                                                                                                                                                                                    |
      |                                   | .. note::                                                                                                                                                                                          |
      |                                   |                                                                                                                                                                                                    |
      |                                   |    The migration task may affect the performance of the source and destination databases. You are advised to start the task in off-peak hours and reserve two to three days for data verification. |
      +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

#. After the task is submitted, view and manage it on the **Online Migration Management** page.

   -  You can view the task status. For more information about task status, see :ref:`Task Statuses <drs_03_0001>`.
   -  You can click |image2| in the upper right corner to view the latest task status.

.. |image1| image:: /_static/images/en-us_image_0000001341094584.png
.. |image2| image:: /_static/images/en-us_image_0000001391694113.png
